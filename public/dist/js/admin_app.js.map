{"version":3,"sources":["c.js","admin_categories_form.js","admin_products_form.js","admin-email-templates.js","dashboard.js","menu_configuration.js","admin_settings.js","admin_logs.js","infiniteLoading.js","product_import.js","categories_import.js","ca.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"admin_app.js","sourcesContent":["$(function(){\n\n    $.ajaxSetup({\n        headers: {\n            'X-CSRF-TOKEN' : $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    });\n\n    $(document).ajaxError(function(event, request, settings){\n        switch(request.status){\n            case 401:\n\n                $('#login-required-modal').modal({\n                    backdrop: 'static',\n                    keyboard: true,\n                    show: true\n                });\n\n                break;\n        }\n    });\n\n    $(\".nav .dropdown-toggle\").click(function () {\n        window.location = this.href;\n    });\n\n    $('input[type=checkbox], input[type=radio]').each(function(){\n        if ($(this).hasClass('small-icheck')){\n\n        } else {\n            $(this).iCheck({\n                checkboxClass: 'icheckbox_square-blue',\n                radioClass: 'iradio_square-blue',\n                increaseArea: '0'\n            });\n        }\n    });\n\n    //async load of images for the product tiles\n\n    var handleVisibilityChange = function(){\n        $('.product-tile .image-async-loader').each(function(){\n            if ($(this).parent().parent().visible(true, true)){\n\n                var src = $(this).attr('data-src');\n                var alt = $(this).attr('data-alt');\n\n                var parent = $(this).closest('.product-image');\n\n                //$(this).closest('.product-image').addClass('no-back');\n                $(this).replaceWith('<img src=\"' + src + '\" alt=\"' + alt + '\"/>');\n\n                $(parent).find('img').one(\"load\", function() {\n                    parent.addClass('no-back');\n                }).each(function() {\n                    if(this.complete) $(this).load();\n                });\n            }\n        });\n    };\n\n    $(document).on('scroll', function(){\n        handleVisibilityChange();\n    });\n\n    $(document).on('resize', function(){\n        handleVisibilityChange();\n    });\n\n    handleVisibilityChange();\n\n    // animation added to the product tile hover overlay\n    // $(document).on('mouseenter', '.product-tile .overlay a', function(){\n    //     if (!$(this).closest('.product-tile').hasClass('wishlist-tile')){\n    //         $(this).addClass('animated infinite pulse');\n    //     }\n    // });\n    //\n    // $(document).on('mouseleave', '.product-tile .overlay a', function(){\n    //     if (!$(this).closest('.product-tile').hasClass('wishlist-tile')){\n    //         $(this).removeClass('animated infinite pulse');\n    //     }\n    // });\n\n    var handleClickOnSimilarProduct = function(elem){\n        $(elem).find('form').submit();\n    };\n\n    $(document).on('click', '.product-tile a', function(e){\n        e.stopPropagation();\n        e.preventDefault();\n        if (!$(this).is('.wishlist')){\n            if ($('.similar-products').has($(this)).length == 0){\n                $(this).closest('.product-tile-wrapper').productModal();\n            } else {\n                handleClickOnSimilarProduct($(this).closest('.product-tile-wrapper'));\n            }\n\n        }\n    });\n\n    $(document).on('click', '.product-tile', function(){\n        if ($('.similar-products').has($(this)).length == 0){\n            $(this).closest('.product-tile-wrapper').productModal();\n        } else {\n            handleClickOnSimilarProduct($(this).closest('.product-tile-wrapper'));\n        }\n    });\n\n    var updateIfInModal = function(elem, status){\n        if (elem.closest('.product-modal').size() > 0){\n            // find the product tile wrapper\n\n            var wrapper = $('.product-tile-wrapper.active').first();\n\n            if (wrapper){\n\n                var button = wrapper.find('.wishlist').first();\n\n                console.log(button);\n\n                if (status == true){\n                    button.removeClass('prim-btn');\n                    button.addClass('on-wishlist def-btn');\n                    wrapper.attr('data-on-wishlist', 'true')\n                } else {\n                    button.removeClass('on-wishlist');\n                    button.removeClass('def-btn');\n                    button.addClass('prim-btn');\n                    wrapper.attr('data-on-wishlist', 'false')\n                }\n\n            }\n\n        }\n    };\n\n\n    //wishlist behaviour\n    $(document).on('click', '.wishlist', function(e){\n        e.preventDefault();\n        e.stopPropagation();\n        var that = this;\n        $.post($(this).attr('data-url'), {p: $(this).attr('data-pi')})\n            .success(function(res){\n                if (res.message == 'added'){\n                    $(that).removeClass('prim-btn');\n                    $(that).addClass('on-wishlist def-btn');\n                    updateIfInModal($(that), true);\n                } else {\n                    $(that).removeClass('on-wishlist');\n                    $(that).removeClass('def-btn');\n                    $(that).addClass('prim-btn');\n                    updateIfInModal($(that), false);\n                }\n\n                if ($(that).hasClass('remove_on_toggled')){\n                    $(that).closest('.product-tile-wrapper').remove();\n\n                    //search for products on wishlist if in profile page to show\n                    // the no products message after last product removal\n                    if ($('.profile-wishlist-wrapper').size() > 0){\n                        if ($('.profile-wishlist-wrapper .product-tile-wrapper').size() == '0'){\n                            $('.profile-wishlist-wrapper').find('p').show();\n                        }\n                    }\n\n                }\n            })\n            .error(function(data, textStatus, errorThrown){\n            });\n    });\n\n    //global alert showing\n    $('.sysalert').each(function(){\n        //bootbox.alert($(this).text());\n\n        var that = this;\n\n        if ($(this).attr('data-type') == 'success'){\n            bootbox.dialog({\n                message: $(that).text(),\n                title: \"Aviso\",\n                buttons: {\n                    success: {\n                        label: \"OK\",\n                        className: \"btn-success\",\n                        callback: function() {\n\n                        }\n                    }\n                }\n            });\n            return;\n        }\n\n        if ($(this).attr('data-type') == 'error'){\n            bootbox.dialog({\n                message: $(that).text(),\n                title: \"Upps. Se ha producido un error\",\n                buttons: {\n                    success: {\n                        label: \"OK\",\n                        className: \"btn-danger\",\n                        callback: function() {\n\n                        }\n                    }\n                }\n            });\n            return;\n        }\n\n    });\n\n    if ($(window).height() > $('body').height()){\n        $('#main-footer').addClass('fixed');\n    }\n\n    $('.sns').each(function(){\n        $(this).snsShare($(this).attr('data-sns-title'), $(this).attr('data-sns-url'));\n    });\n\n    $('.see-more-filter-list').each(function(){\n        $(this).seeMoreFilters({\n            initial: 4,\n            moreLabel: '+ Ver más'\n        })\n    });\n});","$(function(){\n    $('#category-form').validate({\n        rules: {\n            category_title: {\n                required: true,\n            },\n            category_url: {\n                required: true,\n            },\n            category_meta_title: {\n                required: true,\n            },\n            category_sorting: 'required',\n        },\n        errorPlacement: function(error, element){\n            if ($(element).is('input:checkbox') || $(element).is('input:radio')){\n                error.appendTo(element.closest('.form-group'));\n            } else {\n                error.appendTo(element.parent());\n            }\n        }\n    });\n});","$(function(){\n\n    $('#product-category').select2();\n\n    $('#product-form').validate({\n        rules: {\n            product_title: {\n                required: true,\n                minlength: 4\n            },\n            product_id: 'required',\n            product_category: 'required',\n            product_url: 'required',\n            product_destination_url: {\n                required: true,\n                url: true\n            },\n            product_price: {\n                required: true,\n                number: true,\n                min: 0\n            },\n            product_previous_price: {\n                number: true,\n                min: 0\n            },\n            product_coupon_url: {\n                url: true\n            },\n            product_meta_title: 'required',\n            product_meta_description: 'required'\n        },\n        messages: {\n            product_title: {\n                minlength: 'El título del producto debe tener al menos 4 caracteres'\n            },\n            product_destination_url: {\n                url: 'Debe escribir una url válida'\n            },\n            product_price: {\n                number: 'Debe escribir un número válido',\n                min: 'Debe escribir un número mayor que 0'\n            },\n            product_previous_price: {\n                number: 'Debe escribir un número válido',\n                min: 'Debe escribir un número mayor que 0'\n            },\n            product_coupon_url: {\n                url: 'Debe escribir una url válida'\n            }\n        }\n    });\n});","$(document).on('click', '#send-mail-btn', function(e){\n    e.preventDefault();\n    var alertContainer = $('#test-email-form .alert').first();\n    alertContainer.attr('class', 'alert');\n    alertContainer.empty();\n    alertContainer.hide();\n    $.post($('#test-email-form').attr('action'), {email: $('#email_address').val(), template: $('#email_template').val()})\n        .success(function(res){\n            if (res.status == 'not_valid'){\n\n                alertContainer.addClass('alert-danger');\n\n                for (var i in res.messages){\n                    alertContainer.append('<p>' + res.messages[i] + '</p>')\n                }\n\n                alertContainer.show();\n\n                return;\n            }\n            if (res.status == 'success'){\n                alertContainer.addClass('alert-success');\n\n                alertContainer.append('<p>Se ha enviado un email de prueba correctamente</p>');\n\n                alertContainer.show();\n                return;\n            }\n        })\n        .fail(function(){\n            alert('error');\n        });\n});","$(function(){\n\n    $(document).on('click', '.global-index-action', function(e){\n        e.preventDefault();\n\n        var that = this;\n\n        bootbox.confirm($(that).attr('data-confirm-message'), function(res){\n            if (res == true){\n\n                var icon = $(that).find('i');\n\n                icon.removeClass(icon.attr('data-regular-icon'));\n\n                icon.addClass('fa-spinner fa-spin');\n\n                $.post($(that).attr('href'))\n                    .success(function(res){\n                        bootbox.alert(res.message);\n                    })\n                    .fail(function(){\n                        bootbox.alert('Ha ocurrido un error al realizar la acción requerida');\n                    })\n                    .done(function(){\n                        icon.removeClass('fa-spinner fa-spin');\n                        icon.addClass(icon.attr('data-regular-icon'));\n                    });\n            }\n        });\n\n    });\n\n});","$(function(){\n\n    //var items = [];\n\n    var tableRowTemplate = '<tr>' +\n                                '<td>{title}</td>' +\n                                '<td class=\"text-center\"><input type=\"checkbox\" class=\"change-child-visibility\" {checked} /></td>' +\n                                '<td class=\"text-center\">' +\n                                    '<div class=\"custom-slider\">' +\n                                        '<span class=\"value\"></span>' +\n                                        '<span class=\"controls\">' +\n                                            '<a href=\"#\" class=\"change-order inc-control\"><i class=\"fa fa-chevron-up\"></i></a>' +\n                                            '<a href=\"#\" class=\"change-order dec-control\"><i class=\"fa fa-chevron-down\"></i></a>' +\n                                        '</span>' +\n                                    '</div>' +\n                                '</td>' +\n                                '<td>' +\n                                    '<a class=\"remove-menu-item-button\" href=\"#\"><i class=\"fa fa-trash-o\"></i></a></td>' +\n                            '</tr>';\n\n    var navbarDropdownTemplate = '<li class=\"dropdown\">' +\n                                    '<a href=\"{menu_link}\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-expanded=\"false\">{menu_title}<span class=\"caret\"></span></a>' +\n                                    '<ul class=\"dropdown-menu\" role=\"menu\">' +\n                                        '{child}' +\n                                    '</ul>' +\n                                 '</li>';\n\n    var navbarDropdownChildTemplate = '<li><a href=\"{children_link}\">{children_title}</a></li>';\n\n    var navbarSingleItemTemplate = '<li><a href=\"{menu_link}\">{menu_title}</a></li>';\n\n\n    var updateServer = function(){\n        $.post($('.menu-definition').attr('data-action-url'), {action: 'update', items: window.menu_definition})\n            .success(function(){\n\n            })\n            .error(function(){\n\n            });\n    };\n\n    var generateTableAndPreview = function(){\n\n        $('.menu-definition tbody tr').each(function(){\n            if (!$(this).hasClass('no-items-row')){\n                $(this).remove();\n            }\n        });\n\n        $('.navbar-items').empty();\n\n        if (window.menu_definition.length == 0){\n\n            $('.menu-definition').addClass('no-items');\n\n        } else {\n\n            $.each(window.menu_definition, function(){\n\n                var element = tableRowTemplate\n                    .replace('{title}', this.title)\n                    .replace('{checked}', this.display_children ? 'checked=\"checked\"' : '');\n\n                element = $(element);\n\n                element.prop('bound-data', this);\n\n                $('.menu-definition tbody').append(element);\n\n                //update the preview\n                var listItem = '';\n                var children = '';\n\n                if (this.display_children && this.children != undefined && this.children.length > 0){\n                    listItem = navbarDropdownTemplate\n                        .replace('{menu_title}', this.title)\n                        .replace('{menu_link}', this.url);\n\n                    $.each(this.children, function(){\n                        children += navbarDropdownChildTemplate\n                            .replace('{children_title}', this.title)\n                            .replace('{children_link}', this.url);\n                    });\n\n                    listItem = listItem.replace('{child}', children);\n\n                    $('.navbar-items').append($(listItem));\n\n                } else {\n\n                    listItem = navbarSingleItemTemplate\n                        .replace('{menu_title}', this.title)\n                        .replace('{menu_link}', this.url);\n\n                    $('.navbar-items').append($(listItem));\n                }\n\n            });\n\n        }\n\n        $('input[type=checkbox], input[type=radio]').iCheck({\n            checkboxClass: 'icheckbox_square-blue',\n            radioClass: 'iradio_square-blue',\n            increaseArea: '0'\n        });\n    };\n\n    var sortItems = function(){\n\n        window.menu_definition = window.menu_definition.sort(function(a, b){\n            return a.position - b.position;\n        });\n\n    };\n\n    var setInitialPositions = function(){\n        var pos = 1;\n        for (var i in window.menu_definition){\n            window.menu_definition[i].position = pos;\n            window.menu_definition[i].index = i;\n            pos++;\n        }\n    };\n\n    var moveItem = function(item, direction){\n\n        switch(direction){\n            case 'up':\n                //find previous item\n                window.menu_definition[parseInt(item.index) - 1].position = parseInt(window.menu_definition[parseInt(item.index) - 1].position) + 1;\n                window.menu_definition[item.index].position = parseInt(window.menu_definition[item.index].position) - 1;\n                break;\n            case 'down':\n                //find next item\n                window.menu_definition[parseInt(item.index) + 1].position = parseInt(window.menu_definition[parseInt(item.index) + 1].position) - 1;\n                window.menu_definition[item.index].position = parseInt(window.menu_definition[item.index].position) + 1 ;\n                break;\n        }\n\n        sortItems();\n        setInitialPositions();\n        generateTableAndPreview();\n        updateServer();\n    };\n\n    var addItem = function(category, display_children, index){\n        $.post($('.menu-definition').attr('data-action-url'), {action: 'add', category: category, display_children: display_children, index: index })\n            .success(function(res){\n                if (res.status == 'success'){\n                    //add the item at the end of menu definition and update the view\n                    window.menu_definition.push(res.menu_item);\n                    setInitialPositions();\n                    generateTableAndPreview();\n                    $('#new-item-modal').modal('hide');\n                } else {\n                    $('#add-item-form p.error').text(res.message);\n                }\n            })\n            .error(function(){\n\n            });\n    };\n\n    var init = function(){\n        setInitialPositions();\n        generateTableAndPreview();\n    };\n\n    if ($('.menu-configuration-page').size() > 0){\n        init();\n    }\n\n    $(document).on('click', '.change-order', function(e){\n        e.preventDefault();\n\n        var $row = $(this).closest('tr');\n        var data = $row.prop('bound-data');\n        if ($(this).hasClass('inc-control')){\n            if (data.index != 0){\n                moveItem(data, 'up');\n            }\n        } else {\n            if (data.index != (window.menu_definition.length - 1)){\n                moveItem(data, 'down');\n            }\n        }\n    });\n\n    $(document).on('ifChanged', '.change-child-visibility', function(){\n\n        var data = $(this).closest('tr').prop('bound-data');\n\n        window.menu_definition[data.index].display_children = $(this).prop('checked');\n\n        generateTableAndPreview();\n    });\n\n    $(document).on('click', '.add-item', function(e){\n        e.preventDefault();\n\n        $('#new-item-modal').modal({\n            show: true,\n            backdrop: 'static',\n            keyboard: true\n        });\n\n    });\n\n    $(document).on('click', '.add-item-submit', function(e){\n        e.preventDefault();\n\n        var category = $('#category').val();\n        var display_children = $('#display-children').val();\n\n        addItem(category, display_children, $('.menu-definition tbody tr').size() - 1);\n\n    });\n\n    $(document).on('click', '.remove-menu-item-button', function(e){\n        e.preventDefault();\n\n        var $row = $(this).closest('tr');\n        var data = $row.prop('bound-data');\n\n        $.post($('.menu-definition').attr('data-action-url'), {action: 'remove', 'id': data.id})\n            .success(function(){\n                $row.remove();\n\n                window.menu_definition.splice(data.index, 1);\n\n                setInitialPositions();\n                sortItems();\n                updateServer();\n                generateTableAndPreview();\n\n            })\n            .fail(function(){\n                alert('error');\n            });\n\n    });\n\n});","$(function(){\n\n    $(document).on('ifChanged', '.image-engine-selector', function(){\n        if ($(this).val() == 'thumbor'){\n            $('.thumbor-url').slideDown();\n        } else {\n            $('.thumbor-url').slideUp();\n        }\n    });\n\n    $('#settings-form').validate({\n        rules: {\n            'app_title': 'required',\n            'currency_name': 'required',\n            'currency_html_code': 'required',\n            'money_decimal_digits': 'required',\n            'money_decimal_separator': 'required',\n            'money_thousands_separator': 'required',\n            'product_order_limit': {\n                required: true,\n                number: true\n            }\n        }\n    });\n\n});\n","$(function(){\n    $('.logs-table-container').on('click', '.expand', function(){\n        $('#' + $(this).attr('data-display')).toggle();\n    });\n});\n","(function(){\n\n    $.fn.infiniteLoading = function(options, params){\n\n        return $(this).each(function(){\n\n            var that = this;\n\n            var api = {\n                setMessage: function(message){\n                    $(that).closest('.modal-body').find('.message-wrapper').text(message);\n                },\n                setPersistentMessage: function(message){\n                    $(that).closest('.modal-body').find('.persistent-messages').append(message);\n                },\n                setCompleted: function(){\n                    $(that).prop('completed', true);\n                    $(that).find('.progress-bar').addClass('progress-bar-success');\n                    $(that).closest('.modal-body').find('.close-button-wrapper').show();\n                },\n                resetData: function(){\n                    $(that).closest('.modal-body').find('.message-wrapper').empty();\n                    $(that).closest('.modal-body').find('.persistent-messages').empty();\n                    $(that).closest('.modal-body').find('.close-button-wrapper').hide();\n                    $(that).find('.progress-bar').removeClass('progress-bar-success');\n                }\n            };\n\n            var init = function(){\n                $(that).addClass('il');\n\n            };\n\n            if (!$(that).hasClass('il')){\n\n                init();\n            } else {\n                if (options !== undefined){\n                    api[options](params);\n                }\n            }\n\n        });\n    };\n})(jQuery);","$(function(){\n\n    if ($('.product-import').size() > 0){\n\n        var file = null;\n\n        var setMessage = function(elem, message){\n            $(elem).closest('.modal-body').find('.message-wrapper').text(message);\n        };\n\n        var setPersistentMessage = function(elem, message){\n            $(elem).closest('.modal-body').find('.persistent-messages').append(message);\n        };\n\n        var setCompleted = function(elem, message){\n            $(elem).prop('completed', true);\n            $(elem).find('.progress-bar').addClass('progress-bar-success');\n            $(elem).closest('.modal-body').find('.close-button-wrapper').show();\n            setMessage(elem, message);\n        };\n\n        var resetData = function(elem){\n            $(elem).closest('.modal-body').find('.message-wrapper').empty();\n            $(elem).closest('.modal-body').find('.persistent-messages').empty();\n            $(elem).closest('.modal-body').find('.close-button-wrapper').hide();\n            $(elem).find('.progress-bar').removeClass('progress-bar-success');\n        };\n\n        $('#loading-modal').on('shown.bs.modal', function (e) {\n\n            var elem = $('.infinite-progress');\n\n            var import_id = null;\n\n            resetData(elem);\n\n            setMessage(elem, 'Importando los productos');\n\n            $.post(window.app_prefix + '/admin/products/import', {\n                file: file\n            })\n            .success(function(res){\n\n                if (res.status == 'success'){\n\n                    $('.import-results').html(res.results);\n\n                    import_id = res.import_id;\n\n                    setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n                    setMessage(elem, 'Actualizando rutas de la aplicación');\n\n                    $.post(window.app_prefix + '/admin/products/update_routes', {import_id: import_id})\n                .success(function(res){\n\n                        if (res.status == 'success'){\n\n                            setMessage(elem, 'Actualizando motor de búsqueda');\n                            setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n\n                            $.post(window.app_prefix + '/admin/search-engine-refresh', {import_id: import_id})\n                                .success(function(res){\n                                    if (res.status == 'success'){\n                                        setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n                                        setCompleted(elem, 'La operación ha finalizado');\n\n                                    } else {\n\n                                        setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n\n                                    }\n                                })\n                                .fail(function(){\n\n                                    setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al actualizar el índice de búsqueda</p>');\n\n                                });\n\n                        } else {\n\n                            setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n\n                        }\n\n                    })\n                        .fail(function(){\n\n                            setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al actualizar las rutas de la aplicación. Inténtelo nuevamente.</p>');\n\n                        });\n\n                } else {\n\n                    setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n\n                }\n\n            })\n                .fail(function(){\n                    setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al importar el fichero, inténtelo nuevamente.</p>');\n                });\n        });\n\n        $('#loading-modal').modal({\n            backdrop: 'static',\n            keyboard: false,\n            show: false\n        });\n\n        $('#fileupload').fileupload({\n            url: window.app_prefix + '/admin/products/upload',\n            dataType: 'json',\n            send: function(e, data){\n                var elem = $('#upload-btn > span');\n                var text = elem.text();\n                elem.text(elem.attr('data-loading-text'));\n                elem.attr('data-loading-text', text);\n                $('.import-results').empty();\n            },\n            done: function (e, data) {\n                var result = data.result;\n                if (result.status == 'success'){\n                    file = result.filename;\n                    $('#loading-modal').modal('show');\n                } else {\n                    bootbox.alert('Ha ocurrido un error al subir el fichero');\n                }\n            },\n            always: function(e, data){\n                var elem = $('#upload-btn > span');\n                var text = elem.text();\n                elem.text(elem.attr('data-loading-text'));\n                elem.attr('data-loading-text', text);\n            }\n        }).prop('disabled', !$.support.fileInput)\n            .parent().addClass($.support.fileInput ? undefined : 'disabled');\n\n    }\n});","$(function(){\n\n    if ($('.category-import').size() > 0){\n        var file = null;\n\n        var setMessage = function(elem, message){\n            $(elem).closest('.modal-body').find('.message-wrapper').text(message);\n        };\n\n        var setPersistentMessage = function(elem, message){\n            $(elem).closest('.modal-body').find('.persistent-messages').append(message);\n        };\n\n        var setCompleted = function(elem, message){\n            $(elem).prop('completed', true);\n            $(elem).find('.progress-bar').addClass('progress-bar-success');\n            $(elem).closest('.modal-body').find('.close-button-wrapper').show();\n            setMessage(elem, message);\n        };\n\n        var resetData = function(elem){\n            $(elem).closest('.modal-body').find('.message-wrapper').empty();\n            $(elem).closest('.modal-body').find('.persistent-messages').empty();\n            $(elem).closest('.modal-body').find('.close-button-wrapper').hide();\n            $(elem).find('.progress-bar').removeClass('progress-bar-success');\n        };\n\n        $('#loading-modal').on('shown.bs.modal', function (e) {\n\n            var elem = $('.infinite-progress');\n\n            resetData(elem);\n\n            setMessage(elem, 'Importando las categorías');\n\n            $.post(window.app_prefix + '/admin/categories/import', {\n                    file: file\n                })\n                .success(function(res){\n\n                    if (res.status == 'success'){\n\n                        $('.import-results').html(res.results);\n\n                        setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n                        setMessage(elem, 'Actualizando rutas de la aplicación');\n\n                        $.post(window.app_prefix + '/admin/products/update_categories_routes')\n                            .success(function(res){\n\n                                if (res.status == 'success'){\n\n                                    setMessage(elem, 'Actualizando árbol de categorías');\n                                    setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n\n                                    $.post(window.app_prefix + '/admin/products/update_category_tree')\n                                        .success(function(res){\n                                            if (res.status == 'success'){\n                                                setPersistentMessage(elem, '<p class=\"success\">' + res.message + '</p>');\n                                                setCompleted(elem, 'La operación ha finalizado');\n                                            } else {\n                                                setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n                                                setCompleted(elem, 'La operación no ha sido llevada a cabo');\n                                            }\n                                        })\n                                        .fail(function(){\n                                            setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al actualizar el árbol de categorías</p>');\n                                            setCompleted(elem, 'La operación no ha sido llevada a cabo');\n                                        });\n\n                                } else {\n\n                                    setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n                                    setCompleted(elem, 'La operación no ha sido llevada a cabo');\n\n                                }\n\n                            })\n                            .fail(function(){\n\n                                setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al actualizar las rutas de la aplicación. Inténtelo nuevamente.</p>');\n                                setCompleted(elem, 'La operación no ha sido llevada a cabo');\n\n                            });\n\n                    } else {\n\n                        setPersistentMessage(elem, '<p class=\"error\">' + res.message + '</p>');\n                        setCompleted(elem, 'La operación no ha sido llevada a cabo');\n\n                    }\n\n                })\n                .fail(function(){\n\n                    setPersistentMessage(elem, '<p class=\"error\">Ha ocurrido un error al importar el fichero, inténtelo nuevamente.</p>');\n                    setCompleted(elem, 'La operación no ha sido llevada a cabo');\n\n                });\n        });\n\n        $('#loading-modal').modal({\n            backdrop: 'static',\n            keyboard: false,\n            show: false\n        });\n\n\n        $('#fileupload').fileupload({\n            url: window.app_prefix + '/admin/categories/upload',\n            dataType: 'json',\n            send: function(e, data){\n                var elem = $('#upload-btn > span');\n                var text = elem.text();\n                elem.text(elem.attr('data-loading-text'));\n                elem.attr('data-loading-text', text);\n                $('.import-results').empty();\n            },\n            done: function (e, data) {\n                var result = data.result;\n                if (result.status == 'success'){\n                    file = result.filename;\n                    $('#loading-modal').modal('show');\n                } else {\n                    bootbox.alert('Ha ocurrido un error al subir el fichero');\n                }\n            },\n            always: function(e, data){\n                var elem = $('#upload-btn > span');\n                var text = elem.text();\n                elem.text(elem.attr('data-loading-text'));\n                elem.attr('data-loading-text', text);\n            }\n        }).prop('disabled', !$.support.fileInput)\n            .parent().addClass($.support.fileInput ? undefined : 'disabled');\n\n    }\n});","$(function(){\n\n    $(document).on('click', 'a.global-action', function(e){\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        var $link = $(this);\n\n        var postData = {\n            type: $link.attr('data-otype'),\n            id: $link.attr('data-oid'),\n            action: $link.attr('data-action')\n        };\n\n        var performAction = function(){\n            $.post(window.app_prefix + '/admin/global-action', postData)\n                .success(function(res){\n\n                    if ($link.closest('.dataTable').size() > 0){\n                        $link.closest('.dataTable').dataTable().api().ajax.reload(function(){\n                            bootbox.alert(res.message);\n                        }, false);\n                    }\n\n                })\n                .fail(function(){\n                    bootbox.alert('Ha ocurrido un error al realizar la acción');\n                });\n        };\n\n\n        if ($link.attr('data-confirm')){\n            bootbox.confirm($link.attr('data-confirm'), function(res){\n                if (res == true){\n                    performAction();\n                }\n            });\n        } else {\n            performAction();\n        }\n    });\n\n});"]}